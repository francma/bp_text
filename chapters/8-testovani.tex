\chapter{Testování}

K psaní testů jsem využil Python knihovnu pytest a k správě prostředí testu nástroj tox.
Úkolem nástroje tox je vytvořit nové virtuální prostředí (virtualenv), v něm nainstalovat závisloti projektu i projekt samotný a nakonec spustit testy dle zadání.
Použití virtuenv prostředí odstraní možné problémy s lokálním prostředím (kolegovi to funguje, ale mě nikoliv).

Ke statické analýze kódu jsem využil knihovny mypy, která dokáže zkontrolovat typovou správnost z poskytnutých typových anotací.

\begin{listing}[ht]
\begin{minted}[frame=single,linenos]{python}
def test_authorize(container: Container):
    app = container.get_app()
    app.testing = True

    user1 = User.create(
        email='user1@email.com',
        role=UserRole.NORMAL,
        public_key='AAA'
    )

    client = app.test_client()
    r = client.get('/identity', headers={
        'Authorization': 'Bearer ' + str(user1.token)
    })

    assert r.status_code is not HTTPStatus.FORBIDDEN
\end{minted}
\caption{Ukázka testu pomocí knihovny pytest}
\end{listing}

Testy jsou dostupné v repozitářích projektů v podsložce \verb|tests| a spouští se přes příkaz \verb|tox|.

Mimo testů samotných je součástí projektu i jednoduchý skript, který nainstaluje v testovacím režimu všechny části Piper CI systému, založí uživatele, nový projekt a spustí testovací integraci.
Jedná se v podstatě o kompletní integrační test.

U testování webového rozhraní byl zvolen jiný způsob testování, protože obsahuje minimální množství testovatelného kódu.
Webové rozhraní v podstatě pouze dotazuje REST API Piper CI jádra a interpretuje výsledky.
Pro tento účel byla vytvořena \uv{falešná} datová třída, poskytující testovací data.
Testování není tedy prováděno automaticky, ale je třeba manuálně webové rozhraní projít pro odhalení případných chyb.

V průběhu vývoje jsem využil získaných zkušeností ohledně systémů kontinuální integrace a začleníl jsem všechny projekty vytvořené v rámci této práce do kontinuální integrace.
Konkrétně jsem zvolil Travis CI.

